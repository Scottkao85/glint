var app=angular.module("glint",["glint.services","glint.ideas","glint.ideaDetail","glint.votes","glint.auth","glint.comments","ngAnimate","ngRoute"]).config(function(a,b){a.when("/",{templateUrl:"app/ideas/ideas.html",controller:"IdeasCtrl as ictrl"}).when("/login",{templateUrl:"app/auth/login.html",controller:"AuthCtrl as actrl"}).when("/signup",{templateUrl:"app/auth/signup.html",controller:"AuthCtrl as actrl"}).when("/ideas/:_id/collaborators",{templateUrl:"app/ideaDetail/ideaDetail.html",controller:"IdeaCollaboratorsCtrl as iclctrl"}).when("/ideas/:_id/comments",{templateUrl:"app/ideas/ideaDetail.html",controller:"AuthCtrl as actrl"}).otherwise({redirectTo:"/"}),b.interceptors.push("AttachTokens")}).factory("AttachTokens",function(a){var b={request:function(b){var c=a.localStorage.getItem("com.shortly");return c&&(b.headers["x-access-token"]=c),b.headers["Allow-Control-Allow-Origin"]="*",b}};return b}).run(function(a,b,c){a.$on("$routeChangeStart",function(a,d){d.$$route&&d.$$route.authenticate&&!c.isAuth()&&b.path("/signin")})}).filter("moment",function(){return function(a){return moment(a).fromNow()}}),glintServices=angular.module("glint.services",[]);glintServices.factory("Ideas",function(a){var b=function(){return a({method:"GET",url:"/api/ideas"}).then(function(a){return a.data})["catch"](function(a){console.error("getIdeas error",a)})},c=function(b){return a({method:"POST",url:"/api/ideas",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("createIdeas error",a)})};return{getIdeas:b,createIdea:c}}),glintServices.factory("IdeaDetail",function(a){var b=function(b){return a({method:"GET",url:"/api/ideas/"+b}).then(function(a){return console.log("factory sees:",a),a.data})["catch"](function(a){console.error("getIdeas error",a)})},c=function(b){return console.log("factory adding collab"),a({method:"POST",url:"/api/collaborators/",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("createIdeas error",a)})},d=function(){};return{getIdea:b,addCollaborator:c,removeCollaborator:d}}),glintServices.factory("Votes",function(a){var b=function(b){return a({method:"POST",url:"/api/vote/upvote",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("upvote error",a)})},c=function(b){return a({method:"POST",url:"/api/vote/downvote",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("downvote error",a)})};return{upvote:b,downvote:c}}),glintServices.factory("Auth",function(a,b,c){var d=function(b){return a({method:"POST",url:"/api/users/signin",data:b}).then(function(a){return a.data.token})},e=function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return a.data.token})},f=function(){return!!c.localStorage.getItem("com.shortly")},g=function(){c.localStorage.removeItem("com.shortly"),b.path("/signin")};return{signin:d,signup:e,isAuth:f,signout:g}}),glintServices.factory("Comments",function(a){var b=function(b){return a({method:"POST",url:"/api/comments",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("createComments error",a)})},c=function(b){return a({method:"GET",url:"/api/comments",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("getComments error",a)})};return{createComment:b,getComments:c}}),angular.module("glint.ideas",[]).controller("IdeasCtrl",function(a,b){var c=this;c.data={ideas:[]},c.idea={},c.postSuccess=!1,c.submitted=!1,c.displayIdeas=function(){a.getIdeas().then(function(a){a=b("orderBy")(a,"votes",!0),c.data.ideas=a})["catch"](function(a){console.error("displayIdeas error",a)})},c.submitIdea=function(){if(console.log("submitting your idea"),c.submitted===!1)c.submitted=!0;else{c.idea.title=_.escape(c.idea.title),c.idea.text=_.escape(c.idea.text);var b=JSON.stringify(c.idea);a.createIdea(b).then(function(){c.postSuccess=!0,c.submitted=!1,c.idea={},c.displayIdeas()})["catch"](function(a){console.error("createIdea error",a)})}},c.displayIdeas()}),angular.module("glint.votes",[]).controller("VotesCtrl",function(a){var b=this;b.upvote=function(b){var c=b;b=JSON.stringify(b),a.upvote(b).then(function(){c.votes++})["catch"](function(a){console.error("upvote error",a)})},b.downvote=function(b){var c=b;b=JSON.stringify(b),a.downvote(b).then(function(){c.votes--})["catch"](function(a){console.error("downvote error",a)})}}),angular.module("glint.auth",[]).controller("AuthCtrl",function(a,b,c){var d=this;d.user={},d.login=function(){d.user.username=_.escape(d.user.username),d.user.password=_.escape(d.user.password);var e=JSON.stringify(d.user);c.signin(e).then(function(c){a.localStorage.setItem("com.shortly",c),b.path("/")})["catch"](function(a){console.error("login error",a)})},d.signup=function(){console.log("signing you up"),d.user.username=_.escape(d.user.username),d.user.password=_.escape(d.user.password);var e=JSON.stringify(d.user);c.signup(e).then(function(c){a.localStorage.setItem("com.shortly",c),b.path("/")})["catch"](function(a){console.error("signup error",a)})}}),angular.module("glint.comments",[]).controller("CommentsCtrl",function(a){var b=this;b.comment={},b.submitComment=function(){comment=JSON.stringify(b.comment),a.createComment(comment).then(function(){})["catch"](function(a){console.error("comment error",a)})},b.displayComments=function(b){a.getComments(b).then(function(){})["catch"](function(a){console.error("displayComments error",a)})}});